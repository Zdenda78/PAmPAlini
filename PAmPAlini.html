<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAmPAlini</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background-color: white;
            overflow: hidden;
            cursor: none;
            position: relative;
            font-family: Arial, sans-serif;
        }

        .switch-container {
            width: 80px;
            height: 30px;
            background-color: #4caf50;
            border-radius: 15px;
            position: absolute;
            cursor: pointer;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease;
            z-index: 30;
            top: 20px;
            left: calc(50% + 300px);
        }

        .switch {
            width: 28px;
            height: 28px;
            background-color: #fff;
            border-radius: 50%;
            position: absolute;
            left: 1px;
            top: 1px;
            transition: left 0.3s ease;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .switch-container.active {
            background-color: #f44336;
        }

        .switch-container.active .switch {
            left: calc(100% - 29px);
        }

        .switch-status {
            position: absolute;
            top: 55px;
            left: calc(50% + 300px);
            width: 80px;
            text-align: center;
            font-size: 16px;
            font-family: "Brush Script MT", cursive;
            color: #00aaff;
            z-index: 30;
        }

        .heart {
            width: 2cm;
            height: 2cm;
            font-size: 2cm;
            line-height: 2cm;
            text-align: center;
            position: absolute;
            display: none;
            animation: float 3s infinite ease-in-out;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .welcome-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: "Brush Script MT", cursive;
        }

        .language-switch {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 30;
            display: flex;
            gap: 10px;
        }

        .language-switch button {
            font-size: 16px;
            padding: 5px 10px;
            background-color: rgba(255, 255, 255, 0.8);
            color: #00aaff;
            border: 2px solid #00aaff;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .language-switch button:hover {
            background-color: #ff0066;
            color: white;
        }

        .language-switch button.active {
            background-color: #00aaff;
            color: white;
        }

        .icon-switch-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .icon-switch-step {
            font-size: 20px;
            color: #00aaff;
            font-family: "Brush Script MT", cursive;
        }

        .icon-switch {
            display: flex;
            gap: 5px;
        }

        .icon-btn {
            font-size: 20px;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid #00aaff;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .icon-btn:hover {
            background-color: #ff0066;
        }

        .pulsating-heart {
            width: 520px;
            height: 560px;
            font-size: 400px;
            line-height: 450px;
            text-align: center;
            animation: pulse 2s infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .input-container {
            position: absolute;
            top: calc(50% + 6.5cm);
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 20;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 10px;
        }

        .input-step {
            font-size: 24px;
            color: #00aaff;
            margin-right: 10px;
            font-family: "Brush Script MT", cursive;
        }

        .welcome-screen input {
            font-size: 24px;
            padding: 5px;
            border: 2px solid #00aaff;
            border-radius: 5px;
            width: 225px;
            background-color: rgba(255, 255, 255, 0.8);
            font-family: "Brush Script MT", cursive;
        }

        .welcome-screen button {
            font-size: 24px;
            padding: 10px 20px;
            background-color: #00aaff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            white-space: nowrap;
            font-family: "Brush Script MT", cursive;
        }

        .welcome-screen button:hover {
            background-color: #ff0066;
        }

        .countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            font-weight: bold;
            display: none;
            z-index: 20;
            opacity: 1;
            font-family: "Brush Script MT", cursive;
        }

        @keyframes growAndFade {
            0% { font-size: 72px; opacity: 1; }
            80% { font-size: 200px; opacity: 1; }
            100% { font-size: 220px; opacity: 0; }
        }

        .crosshair {
            width: 50px;
            height: 50px;
            position: absolute;
            border: 2px solid #00aaff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
            display: block;
        }

        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background-color: #00aaff;
        }

        .crosshair::before {
            width: 100%;
            height: 2px;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
        }

        .crosshair::after {
            width: 2px;
            height: 100%;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
        }

        .score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
            color: #000;
            z-index: 10;
            font-family: "Brush Script MT", cursive;
        }

        .game-timer {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: #000;
            z-index: 10;
            font-family: "Brush Script MT", cursive;
        }

        .game-over {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: #00aaff;
            display: none;
            text-align: center;
            z-index: 10;
            animation: fadeIn 1s ease-in-out;
            font-family: "Brush Script MT", cursive;
            font-weight: 900;
        }

        .restart-menu {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #000;
            display: none;
            text-align: center;
            z-index: 10;
            font-family: "Brush Script MT", cursive;
        }

        .restart-menu a {
            margin: 0 20px;
            text-decoration: none;
            color: #00aaff;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .restart-menu a:hover {
            color: #ff0066;
        }

        .leaderboard {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 200px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 10;
            font-family: "Brush Script MT", cursive;
        }

        .leaderboard h2 {
            margin: 0 0 10px;
            font-size: 20px;
            text-align: center;
        }

        .leaderboard ol {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }

        .leaderboard li {
            margin: 5px 0;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .leaderboard li .name {
            text-align: left;
        }

        .leaderboard li .points {
            text-align: right;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; }
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .wave-container {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 3em;
            font-family: Arial, sans-serif;
            padding: 20px 40px;
            border-radius: 25px;
            box-shadow: 8px 8px 15px rgba(0, 0, 0, 0.3);
            color: white;
            position: absolute;
            overflow: hidden;
            background: linear-gradient(45deg, #ff0000, #ff8c00, #ffd700, #ff8c00, #ff0000);
            background-size: 400% 400%;
            animation: flameBackground 5s ease infinite;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 25;
            opacity: 1;
            transition: opacity 1s ease;
        }

        @keyframes flameBackground {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .wave-letter {
            display: inline-block;
            animation: wave 2s infinite ease-in-out;
        }

        @keyframes wave {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-15px) rotate(5deg); }
            50% { transform: translateY(0) rotate(0deg); }
            75% { transform: translateY(15px) rotate(-5deg); }
        }

        .wave-letter:nth-child(1) { animation-delay: 0s; }
        .wave-letter:nth-child(2) { animation-delay: 0.2s; }
        .wave-letter:nth-child(3) { animation-delay: 0.4s; }
        .wave-letter:nth-child(4) { animation-delay: 0.6s; }
        .wave-letter:nth-child(5) { animation-delay: 0.8s; }
        .wave-letter:nth-child(6) { animation-delay: 1s; }
        .wave-letter:nth-child(7) { animation-delay: 1.2s; }
        .wave-letter:nth-child(8) { animation-delay: 1.4s; }
        .wave-letter:nth-child(9) { animation-delay: 1.6s; }

        .pampalini-info {
            position: absolute;
            top: 50%;
            left: 3cm;
            width: 300px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            font-family: "Brush Script MT", cursive;
            font-size: 16px;
            color: #00aaff;
            z-index: 10;
            line-height: 1.5;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <div class="language-switch" id="languageSwitch">
        <button id="langCZ" class="active">CZ</button>
        <button id="langPL">PL</button>
        <button id="langEN">EN</button>
    </div>

    <div class="wave-container" id="waveBanner">
        <span class="wave-letter">🅿️</span>
        <span class="wave-letter">🅰️</span>
        <span class="wave-letter">🅼️</span>
        <span class="wave-letter">🅿️</span>
        <span class="wave-letter">🅰️</span>
        <span class="wave-letter">🅻️</span>
        <span class="wave-letter">🅸️</span>
        <span class="wave-letter">🅽️</span>
        <span class="wave-letter">🅸️</span>
    </div>

    <div class="icon-switch-container" id="iconSwitchContainer">
        <span class="icon-switch-step">1.</span>
        <div class="icon-switch" id="iconSwitch">
            <button class="icon-btn" data-icon="🐘">🐘</button>
            <button class="icon-btn" data-icon="🐒">🐒</button>
            <button class="icon-btn" data-icon="🦒">🦒</button>
            <button class="icon-btn" data-icon="🦍">🦍</button>
            <button class="icon-btn" data-icon="🦁">🦁</button>
            <button class="icon-btn" data-icon="🐊">🐊</button>
            <button class="icon-btn" data-icon="🦅">🦅</button>
            <button class="icon-btn" data-icon="🧸">🧸</button>
            <button class="icon-btn" data-icon="🦛">🦛</button>
            <button class="icon-btn" data-icon="🐍">🐍</button>
        </div>
    </div>

    <div class="switch-container" id="switchContainer">
        <div class="switch" id="switch"></div>
    </div>
    <span class="switch-status" id="switchStatus">Pomalá hra</span>

    <div class="welcome-screen" id="welcomeScreen">
        <div class="pulsating-heart" id="pulsatingIcon">🐘</div>
        <div class="input-container">
            <span class="input-step">2.</span>
            <input type="text" id="playerName" placeholder="Zadej své jméno..." maxlength="15">
            <button id="startGame">Vstup do hry</button>
        </div>
    </div>

    <div class="pampalini-info" id="pampaliniInfo"></div>

    <div class="countdown" id="countdown"></div>
    <div class="crosshair" id="crosshair"></div>
    <div class="heart" id="heart"></div>
    <div class="score" style="display: none;">Skóre: <span id="score">0</span></div>
    <div class="game-timer" id="gameTimer" style="display: none;">01:00</div>
    <div class="game-over" id="gameOver">KONEC HRY</div>
    <div class="restart-menu" id="restartMenu">Hrát znovu? <a id="yes">ANO</a> / <a id="no">NE</a></div>
    <div class="leaderboard" id="leaderboard">
        <h2>Žebříček</h2>
        <ol id="leaderboardList"></ol>
    </div>

    <audio id="clickSound" preload="auto"></audio>
    <audio id="backgroundMusic" src="https://www.bensound.com/bensound-music/bensound-ukulele.mp3" loop></audio>
    <audio id="welcomeEndMusic" src="https://www.bensound.com/bensound-music/bensound-tenderness.mp3" loop></audio>

    <script>
        let crosshair, heart, scoreElement, gameOverElement, restartMenu, yesButton, noButton, leaderboard, leaderboardList;
        let welcomeScreen, playerNameInput, startGameButton, countdownElement, langCZButton, langPLButton, langENButton, pulsatingIcon;
        let clickSound, backgroundMusic, welcomeEndMusic, gameTimer;
        let score = 0;
        let gameActive = false;
        let fallingHeartsInterval;
        let playerName = '';
        let leaderboardScores = []; // Rychlý režim
        let leaderboardSlowScores = []; // Pomalý režim
        let currentLanguage = 'CZ';
        let keySequence = '';
        let currentIcon = '🐘';
        let spawnInterval = 1250;
        let isSlowMode = true;
        let canSpawn = true;
        let isOnline = true;
        let gameTimerInterval; // Timer interval variable

        const languages = {
            CZ: {
                playerNamePlaceholder: 'Zadej své jméno...',
                startGameText: 'Vstup do hry',
                scoreText: 'Skóre: ',
                gameOverText: 'KONEC HRY',
                restartText: 'Hrát znovu? ',
                yesText: 'ANO',
                noText: 'NE',
                leaderboardTitle: 'Žebříček',
                nameAlert: 'Prosím, zadej své jméno před spuštěním hry!',
                endGameMessage: 'Děkuji, že jste si zahráli.',
                pampaliniInfo: 'Pampalini, byl fiktivní lovec zvířat, hlavní postava polského animovaného seriálu "Pampalini łowca zwierząt" (v češtině "Pampalini, lovec zvířat"). Seriál vznikl v letech 1977–1980 a vytvořilo ho studio Se-ma-for. Pampalini je veselý, nešikovný, ale dobrosrdečný lovec, který se vydává na různé expedice po světě, aby chytil exotická zvířata – od lvů po krokodýly. Jeho plány však většinou končí komickými nezdary, protože zvířata jsou chytřejší nebo šťastnější než on. Seriál je známý svým jednoduchým humorem a výraznou animací typickou pro tehdejší dobu. PAmPAlini hra od Sába Zdeněk 2025.'
            },
            PL: {
                playerNamePlaceholder: 'Wprowadź swoje imię...',
                startGameText: 'Rozpocznij grę',
                scoreText: 'Wynik: ',
                gameOverText: 'KONIEC GRY',
                restartText: 'Zagraj ponownie? ',
                yesText: 'TAK',
                noText: 'NIE',
                leaderboardTitle: 'Ranking',
                nameAlert: 'Proszę, wprowadź swoje imię przed rozpoczęciem gry!',
                endGameMessage: 'Dziękuję za grę.',
                pampaliniInfo: 'Pampalini, był fikcyjnym łowcą zwierząt, głównym bohaterem polskiego serialu animowanego "Pampalini łowca zwierząt". Serial powstał w latach 1977–1980 i został stworzony przez studio Se-ma-for. Pampalini to wesoły, niezdarny, ale dobroduszny łowca, który wyrusza na różne ekspedycje po świecie, aby złapać egzotyczne zwierzęta – od lwów po krokodyle. Jego plany zwykle kończą się komicznymi niepowodzeniami, ponieważ zwierzęta są sprytniejsze lub mają więcej szczęścia niż on. Serial jest znany z prostego humoru i charakterystycznej animacji typowej dla tamtych czasów. PAmPAlini gra od Saba Zdenek 2025.'
            },
            EN: {
                playerNamePlaceholder: 'Enter your name...',
                startGameText: 'Start Game',
                scoreText: 'Score: ',
                gameOverText: 'GAME OVER',
                restartText: 'Play again? ',
                yesText: 'YES',
                noText: 'NO',
                leaderboardTitle: 'Leaderboard',
                nameAlert: 'Please enter your name before starting the game!',
                endGameMessage: 'Thank you for playing.',
                pampaliniInfo: 'Pampalini, was a fictional animal hunter, the main character of the Polish animated series "Pampalini łowca zwierząt". The series was created between 1977–1980 by the Se-ma-for studio. Pampalini is a cheerful, clumsy, but kind-hearted hunter who embarks on various expeditions around the world to catch exotic animals – from lions to crocodiles. However, his plans usually end in comical failures because the animals are smarter or luckier than him. The series is known for its simple humor and distinctive animation typical of that era. PAmPAlini game by Saba Zdenek 2025.'
            }
        };

        function checkInternetConnection() {
            return navigator.onLine;
        }

        function playQuietDeepClick() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.frequency.setValueAtTime(100, audioContext.currentTime);
            oscillator.type = 'square';
            const gainNode = audioContext.createGain();
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start();
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.05);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function setClickSoundSource() {
            clickSound = document.getElementById('clickSound');
            isOnline = checkInternetConnection();
            if (isOnline && !clickSound.hasChildNodes()) {
                const source = document.createElement('source');
                source.src = "https://www.myinstants.com/media/sounds/click.mp3";
                source.type = "audio/mpeg";
                clickSound.appendChild(source);
            }
        }

        function initIconButtons() {
            document.querySelectorAll('.icon-btn').forEach(btn => {
                btn.addEventListener('click', () => changeIcon(btn.dataset.icon));
            });
        }

        function tryPlayMusic(audioElement, errorMessage) {
            audioElement.play().catch(error => {
                console.log(errorMessage, error);
                document.addEventListener('click', () => {
                    audioElement.play().catch(err => console.log('Druhý pokus o přehrání selhal:', err));
                }, { once: true });
            });
        }

        function startGameTimer() {
            let timeLeft = 60; // 1 minute in seconds
            gameTimer = document.getElementById('gameTimer');
            gameTimer.style.display = 'block';
            
            // Clear any existing timer interval
            if (gameTimerInterval) {
                clearInterval(gameTimerInterval);
            }
            
            gameTimerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                gameTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(gameTimerInterval);
                    endGame();
                }
            }, 1000);
        }

        function initWelcome() {
            welcomeScreen = document.getElementById('welcomeScreen');
            playerNameInput = document.getElementById('playerName');
            startGameButton = document.getElementById('startGame');
            leaderboard = document.getElementById('leaderboard');
            leaderboardList = document.getElementById('leaderboardList');
            countdownElement = document.getElementById('countdown');
            langCZButton = document.getElementById('langCZ');
            langPLButton = document.getElementById('langPL');
            langENButton = document.getElementById('langEN');
            crosshair = document.getElementById('crosshair');
            pulsatingIcon = document.getElementById('pulsatingIcon');
            clickSound = document.getElementById('clickSound');
            backgroundMusic = document.getElementById('backgroundMusic');
            welcomeEndMusic = document.getElementById('welcomeEndMusic');
            gameTimer = document.getElementById('gameTimer');

            setClickSoundSource();

            const switchContainer = document.getElementById('switchContainer');
            const switchStatus = document.getElementById('switchStatus');

            switchContainer.addEventListener('click', () => {
                if (isSlowMode) {
                    switchContainer.classList.add('active');
                    spawnInterval = 500;
                    switchStatus.textContent = currentLanguage === 'CZ' ? 'Rychlá hra' : currentLanguage === 'PL' ? 'Szybka gra' : 'Fast Game';
                    isSlowMode = false;
                } else {
                    switchContainer.classList.remove('active');
                    spawnInterval = 1250;
                    switchStatus.textContent = currentLanguage === 'CZ' ? 'Pomalá hra' : currentLanguage === 'PL' ? 'Wolna gra' : 'Slow Game';
                    isSlowMode = true;
                }
                updateLeaderboardDisplay();
            });

            langCZButton.classList.toggle('active', currentLanguage === 'CZ');
            langPLButton.classList.toggle('active', currentLanguage === 'PL');
            langENButton.classList.toggle('active', currentLanguage === 'EN');

            crosshair.style.left = `${window.innerWidth / 2 - crosshair.offsetWidth / 2}px`;
            crosshair.style.top = `${window.innerHeight / 2 - crosshair.offsetHeight / 2}px`;

            startGameButton.addEventListener('click', startGame);
            langCZButton.addEventListener('click', () => switchLanguage('CZ'));
            langPLButton.addEventListener('click', () => switchLanguage('PL'));
            langENButton.addEventListener('click', () => switchLanguage('EN'));

            initIconButtons();

            document.body.style.cursor = 'none';

            document.addEventListener('keydown', handleKeySequence);
            document.addEventListener('mousemove', moveCrosshair);

            loadLeaderboard();
            loadLeaderboardSlow();
            updateLeaderboardDisplay();
            leaderboard.style.display = 'block';
            updateLanguage();

            backgroundMusic.volume = 0.3;
            welcomeEndMusic.volume = 0.3;
            tryPlayMusic(welcomeEndMusic, 'Nepodařilo se přehrát uvítací hudbu:');

            const waveBanner = document.getElementById('waveBanner');
            setTimeout(() => {
                waveBanner.style.opacity = '0';
                setTimeout(() => {
                    waveBanner.style.display = 'none';
                }, 1000);
            }, 2000);
        }

        function switchLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('gameLanguage', lang);
            langCZButton.classList.toggle('active', lang === 'CZ');
            langPLButton.classList.toggle('active', lang === 'PL');
            langENButton.classList.toggle('active', lang === 'EN');
            updateLanguage();
            const switchStatus = document.getElementById('switchStatus');
            switchStatus.textContent = isSlowMode ? 
                (lang === 'CZ' ? 'Pomalá hra' : lang === 'PL' ? 'Wolna gra' : 'Slow Game') : 
                (lang === 'CZ' ? 'Rychlá hra' : lang === 'PL' ? 'Szybka gra' : 'Fast Game');
        }

        function changeIcon(icon) {
            currentIcon = icon;
            pulsatingIcon.textContent = icon;
            if (heart) heart.textContent = icon;
        }

        function updateLanguage() {
            const lang = languages[currentLanguage];
            playerNameInput.placeholder = lang.playerNamePlaceholder;
            startGameButton.textContent = lang.startGameText;
            if (document.querySelector('.score')) document.querySelector('.score').childNodes[0].textContent = lang.scoreText;
            if (gameOverElement) gameOverElement.textContent = lang.gameOverText;
            if (restartMenu) {
                restartMenu.childNodes[0].textContent = lang.restartText;
                if (yesButton) yesButton.textContent = lang.yesText;
                if (noButton) noButton.textContent = lang.noText;
            }
            if (leaderboard) leaderboard.querySelector('h2').textContent = lang.leaderboardTitle;
            document.getElementById('pampaliniInfo').textContent = lang.pampaliniInfo;
        }

        function loadLeaderboard() {
            leaderboardScores = JSON.parse(localStorage.getItem('leaderboard')) || [];
        }

        function loadLeaderboardSlow() {
            leaderboardSlowScores = JSON.parse(localStorage.getItem('leaderboardSlow')) || [];
        }

        function startGame() {
            playerName = playerNameInput.value.trim();
            if (playerName === '') {
                alert(languages[currentLanguage].nameAlert);
                return;
            }

            welcomeScreen.style.display = 'none';
            document.getElementById('languageSwitch').style.display = 'none';
            document.getElementById('iconSwitchContainer').style.display = 'none';
            document.getElementById('switchContainer').style.display = 'none';
            document.getElementById('switchStatus').style.display = 'none';
            document.querySelector('.wave-container').style.display = 'none';
            leaderboard.style.display = 'none';
            document.getElementById('pampaliniInfo').style.display = 'none';
            welcomeEndMusic.pause();
            backgroundMusic.play().catch(() => console.log('Nelze přehrát herní hudbu'));
            startCountdown();
        }

        function startCountdown() {
            let countdown = 3;
            countdownElement.style.display = 'block';

            function updateCountdown() {
                countdownElement.style.animation = 'none';
                countdownElement.offsetHeight;

                if (countdown > 0) {
                    countdownElement.textContent = countdown;
                    countdownElement.style.color = countdown === 3 ? 'red' : countdown === 2 ? 'yellow' : 'green';
                    countdownElement.style.animation = 'growAndFade 1s ease-in-out forwards';
                    if (isOnline) clickSound.play();
                    else playQuietDeepClick();
                    setTimeout(() => {
                        countdown--;
                        updateCountdown();
                    }, 1000);
                } else {
                    countdownElement.style.display = 'none';
                    initGame();
                }
            }

            updateCountdown();
        }

        function initRestartMenu() {
            yesButton = document.getElementById('yes');
            noButton = document.getElementById('no');

            yesButton.removeEventListener('click', handleYesClick);
            noButton.removeEventListener('click', handleNoClick);

            yesButton.addEventListener('click', handleYesClick);
            noButton.addEventListener('click', handleNoClick);
        }

        function handleYesClick() {
            clearInterval(fallingHeartsInterval);
            clearInterval(gameTimerInterval); // Clear the timer interval
            backgroundMusic.pause();
            welcomeEndMusic.play().catch(() => console.log('Nelze přehrát uvítací hudbu'));
            resetToWelcome();
        }

        function handleNoClick() {
            clearInterval(fallingHeartsInterval);
            clearInterval(gameTimerInterval); // Clear the timer interval
            welcomeEndMusic.pause();
            showThankYouAndClose();
        }

        function initGame() {
            heart = document.getElementById('heart');
            scoreElement = document.getElementById('score');
            gameOverElement = document.getElementById('gameOver');
            restartMenu = document.getElementById('restartMenu');
            leaderboard = document.getElementById('leaderboard');
            leaderboardList = document.getElementById('leaderboardList');
            gameTimer = document.getElementById('gameTimer');

            score = 0;
            scoreElement.textContent = score;
            gameActive = true;
            document.body.style.backgroundColor = 'white';

            heart.textContent = currentIcon;
            document.querySelector('.score').style.display = 'block';

            if (isSlowMode) {
                heart.style.width = '3cm';
                heart.style.height = '3cm';
                heart.style.fontSize = '3cm';
                heart.style.lineHeight = '3cm';
            } else {
                heart.style.width = '2cm';
                heart.style.height = '2cm';
                heart.style.fontSize = '2cm';
                heart.style.lineHeight = '2cm';
            }

            document.addEventListener('mousedown', checkShot);

            spawnHeart();
            startGameTimer(); // Start the game timer
            updateLanguage();

            initRestartMenu();
        }

        function moveCrosshair(event) {
            const x = event.clientX;
            const y = event.clientY;
            crosshair.style.left = `${x - crosshair.offsetWidth / 2}px`;
            crosshair.style.top = `${y - crosshair.offsetHeight / 2}px`;

            if (!gameActive && restartMenu.style.display === 'block') {
                const yesRect = yesButton.getBoundingClientRect();
                const noRect = noButton.getBoundingClientRect();
                if (x >= yesRect.left && x <= yesRect.right && y >= yesRect.top && y <= yesRect.bottom) {
                    yesButton.style.color = '#ff0066';
                } else {
                    yesButton.style.color = '#00aaff';
                }
                if (x >= noRect.left && x <= noRect.right && y >= noRect.top && y <= noRect.bottom) {
                    noButton.style.color = '#ff0066';
                } else {
                    noButton.style.color = '#00aaff';
                }
            }
        }

        function showHeart() {
            if (!gameActive || !canSpawn) return;

            const padding = 50;
            const heartWidth = heart.offsetWidth;
            const heartHeight = heart.offsetHeight;
            const maxX = window.innerWidth - heartWidth - padding;
            const maxY = window.innerHeight - heartHeight - padding;
            const minX = padding;
            const minY = padding;

            const x = Math.random() * (maxX - minX) + minX;
            const y = Math.random() * (maxY - minY) + minY;

            heart.textContent = currentIcon;
            heart.style.left = `${x}px`;
            heart.style.top = `${y}px`;
            heart.style.display = 'block';

            const duration = Math.random() * 1000 + 500;
            setTimeout(() => {
                if (heart) heart.style.display = 'none';
            }, duration);
        }

        function checkShot(event) {
            if (!gameActive) return;

            if (event.button !== 0) return;

            const crosshairRect = crosshair.getBoundingClientRect();
            const heartRect = heart.getBoundingClientRect();
            if (
                crosshairRect.left < heartRect.right &&
                crosshairRect.right > heartRect.left &&
                crosshairRect.top < heartRect.bottom &&
                crosshairRect.bottom > heartRect.top
            ) {
                score++;
                scoreElement.textContent = score;
                heart.style.display = 'none';
                if (isOnline) clickSound.play();
                else playQuietDeepClick();

                canSpawn = false;
                document.body.style.backgroundColor = 'pink';
                setTimeout(() => {
                    document.body.style.backgroundColor = 'white';
                    canSpawn = true;
                }, 400);
            }
        }

        function spawnHeart() {
            if (!gameActive) return;
            if (canSpawn) showHeart();
            const interval = Math.random() * spawnInterval + 500;
            setTimeout(spawnHeart, interval);
        }

        function endGame() {
            gameActive = false;
            document.removeEventListener('mousedown', checkShot);
            gameOverElement.style.display = 'block';
            restartMenu.style.display = 'block';
            leaderboard.style.display = 'block';
            backgroundMusic.pause();
            tryPlayMusic(welcomeEndMusic, 'Nepodařilo se přehrát hudbu na game over:');
            if (isSlowMode) {
                updateLeaderboardSlow(score, playerName, currentIcon);
            } else {
                updateLeaderboard(score, playerName, currentIcon);
            }
            updateLeaderboardDisplay();

            fallingHeartsInterval = setInterval(createFallingHeart, 500);
            updateLanguage();

            initRestartMenu();
        }

        function createFallingHeart() {
            const fallingHeart = document.createElement('div');
            fallingHeart.className = 'heart';
            fallingHeart.textContent = currentIcon;
            fallingHeart.style.display = 'block';
            fallingHeart.style.left = `${Math.random() * (window.innerWidth - 50)}px`;
            fallingHeart.style.top = `-50px`;

            if (isSlowMode) {
                fallingHeart.style.width = '3cm';
                fallingHeart.style.height = '3cm';
                fallingHeart.style.fontSize = '3cm';
                fallingHeart.style.lineHeight = '3cm';
            } else {
                fallingHeart.style.width = '2cm';
                fallingHeart.style.height = '2cm';
                fallingHeart.style.fontSize = '2cm';
                fallingHeart.style.lineHeight = '2cm';
            }

            document.body.appendChild(fallingHeart);

            let fallInterval = setInterval(() => {
                const currentTop = parseFloat(fallingHeart.style.top);
                if (currentTop >= window.innerHeight) {
                    clearInterval(fallInterval);
                    fallingHeart.remove();
                } else {
                    fallingHeart.style.top = `${currentTop + 5}px`;
                }
            }, 20);
        }

        function updateLeaderboard(currentScore, playerName, icon) {
            leaderboardScores.push({ name: playerName, score: currentScore, icon: icon });
            leaderboardScores.sort((a, b) => b.score - a.score);
            leaderboardScores = leaderboardScores.slice(0, 10);
            localStorage.setItem('leaderboard', JSON.stringify(leaderboardScores));
        }

        function updateLeaderboardSlow(currentScore, playerName, icon) {
            leaderboardSlowScores.push({ name: playerName, score: currentScore, icon: icon });
            leaderboardSlowScores.sort((a, b) => b.score - a.score);
            leaderboardSlowScores = leaderboardSlowScores.slice(0, 10);
            localStorage.setItem('leaderboardSlow', JSON.stringify(leaderboardSlowScores));
        }

        function updateLeaderboardDisplay() {
            if (isSlowMode) {
                displayLeaderboardSlow();
            } else {
                displayLeaderboard();
            }
        }

        function displayLeaderboard() {
            leaderboardList.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const li = document.createElement('li');
                if (i < leaderboardScores.length) {
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'name';
                    nameSpan.textContent = `${i + 1}. ${leaderboardScores[i].icon} ${leaderboardScores[i].name}`;
                    const pointsSpan = document.createElement('span');
                    pointsSpan.className = 'points';
                    pointsSpan.textContent = `${leaderboardScores[i].score}`;
                    li.appendChild(nameSpan);
                    li.appendChild(pointsSpan);
                } else {
                    li.textContent = `${i + 1}.`;
                }
                leaderboardList.appendChild(li);
            }
        }

        function displayLeaderboardSlow() {
            leaderboardList.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const li = document.createElement('li');
                if (i < leaderboardSlowScores.length) {
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'name';
                    nameSpan.textContent = `${i + 1}. ${leaderboardSlowScores[i].icon} ${leaderboardSlowScores[i].name}`;
                    const pointsSpan = document.createElement('span');
                    pointsSpan.className = 'points';
                    pointsSpan.textContent = `${leaderboardSlowScores[i].score}`;
                    li.appendChild(nameSpan);
                    li.appendChild(pointsSpan);
                } else {
                    li.textContent = `${i + 1}.`;
                }
                leaderboardList.appendChild(li);
            }
        }

        function clearLeaderboard() {
            leaderboardList.style.animation = 'fadeOut 0.5s ease-in-out forwards';
            setTimeout(() => {
                if (isSlowMode) {
                    leaderboardSlowScores = [];
                    localStorage.setItem('leaderboardSlow', JSON.stringify(leaderboardSlowScores));
                    displayLeaderboardSlow();
                } else {
                    leaderboardScores = [];
                    localStorage.setItem('leaderboard', JSON.stringify(leaderboardScores));
                    displayLeaderboard();
                }
                leaderboardList.style.animation = 'none';
            }, 500);
        }

        function handleKeySequence(event) {
            const key = event.key;
            keySequence += key;

            if (!gameActive && leaderboard.style.display === 'block' && keySequence === '0410') {
                clearLeaderboard();
                keySequence = '';
            }

            if (keySequence.length > 4) {
                keySequence = '';
            }
        }

        function resetToWelcome() {
            const switchClass = isSlowMode ? '' : 'active';
            const switchText = isSlowMode ? 
                (currentLanguage === 'CZ' ? 'Pomalá hra' : currentLanguage === 'PL' ? 'Wolna gra' : 'Slow Game') : 
                (currentLanguage === 'CZ' ? 'Rychlá hra' : currentLanguage === 'PL' ? 'Szybka gra' : 'Fast Game');

            document.body.innerHTML = `
                <div class="language-switch" id="languageSwitch">
                    <button id="langCZ" class="${currentLanguage === 'CZ' ? 'active' : ''}">CZ</button>
                    <button id="langPL" class="${currentLanguage === 'PL' ? 'active' : ''}">PL</button>
                    <button id="langEN" class="${currentLanguage === 'EN' ? 'active' : ''}">EN</button>
                </div>
                <div class="wave-container" id="waveBanner">
                    <span class="wave-letter">🅿️</span>
                    <span class="wave-letter">🅰️</span>
                    <span class="wave-letter">🅼️</span>
                    <span class="wave-letter">🅿️</span>
                    <span class="wave-letter">🅰️</span>
                    <span class="wave-letter">🅻️</span>
                    <span class="wave-letter">🅸️</span>
                    <span class="wave-letter">🅽️</span>
                    <span class="wave-letter">🅸️</span>
                </div>
                <div class="icon-switch-container" id="iconSwitchContainer">
                    <span class="icon-switch-step">1.</span>
                    <div class="icon-switch" id="iconSwitch">
                        <button class="icon-btn" data-icon="🐘">🐘</button>
                        <button class="icon-btn" data-icon="🐒">🐒</button>
                        <button class="icon-btn" data-icon="🦒">🦒</button>
                        <button class="icon-btn" data-icon="🦍">🦍</button>
                        <button class="icon-btn" data-icon="🦁">🦁</button>
                        <button class="icon-btn" data-icon="🐊">🐊</button>
                        <button class="icon-btn" data-icon="🦅">🦅</button>
                        <button class="icon-btn" data-icon="🧸">🧸</button>
                        <button class="icon-btn" data-icon="🦛">🦛</button>
                        <button class="icon-btn" data-icon="🐍">🐍</button>
                    </div>
                </div>
                <div class="switch-container ${switchClass}" id="switchContainer">
                    <div class="switch" id="switch"></div>
                </div>
                <span class="switch-status" id="switchStatus">${switchText}</span>
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="pulsating-heart" id="pulsatingIcon">${currentIcon}</div>
                    <div class="input-container">
                        <span class="input-step">2.</span>
                        <input type="text" id="playerName" placeholder="${languages[currentLanguage].playerNamePlaceholder}" maxlength="15" value="">
                        <button id="startGame">${languages[currentLanguage].startGameText}</button>
                    </div>
                </div>
                <div class="pampalini-info" id="pampaliniInfo">${languages[currentLanguage].pampaliniInfo}</div>
                <div class="countdown" id="countdown"></div>
                <div class="crosshair" id="crosshair"></div>
                <div class="heart" id="heart"></div>
                <div class="score" style="display: none;">${languages[currentLanguage].scoreText}<span id="score">0</span></div>
                <div class="game-timer" id="gameTimer">01:00</div>
                <div class="game-over" id="gameOver">${languages[currentLanguage].gameOverText}</div>
                <div class="restart-menu" id="restartMenu">${languages[currentLanguage].restartText}<a id="yes">${languages[currentLanguage].yesText}</a> / <a id="no">${languages[currentLanguage].noText}</a></div>
                <div class="leaderboard" id="leaderboard">
                    <h2>${languages[currentLanguage].leaderboardTitle}</h2>
                    <ol id="leaderboardList"></ol>
                </div>
                <audio id="clickSound" preload="auto"></audio>
                <audio id="backgroundMusic" src="https://www.bensound.com/bensound-music/bensound-ukulele.mp3" loop></audio>
                <audio id="welcomeEndMusic" src="https://www.bensound.com/bensound-music/bensound-tenderness.mp3" loop></audio>
            `;

            initWelcome();
            initRestartMenu();
        }

        function showThankYouAndClose() {
            document.body.innerHTML = `
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; font-size: 48px; color: #00aaff; font-family: 'Brush Script MT', cursive;">
                    ${languages[currentLanguage].endGameMessage}
                </div>
            `;
            document.body.style.backgroundColor = 'white';
            document.body.style.cursor = 'auto';
            backgroundMusic.pause();
            setTimeout(() => window.close(), 2000);
        }

        initWelcome();
    </script>
</body>
</html>
